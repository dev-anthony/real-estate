<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Properties</title>
    <style>
         /* Modal Background */
.modal {
  display: none; 
  position: fixed; 
  z-index: 3000; 
  left: 0;
  top: 0;
  width: 100%; 
  height: 100%; 
  background: rgba(0,0,0,0.5); 
  justify-content: center; 
  align-items: center; 
}

/* Modal Box */
.modal-content {
  background: #fff;
  padding: 20px;
  width: 400px;
  max-width: 90%;
  border-radius: 10px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  animation: fadeIn 0.3s ease;
}

.modal-content h3 {
  margin-bottom: 15px;
  color: #6c63ff;
}

.modal-content label {
  display: block;
  margin-top: 10px;
  font-size: 13px;
  font-weight: 600;
  color: #444;
}

.modal-content input,
.modal-content textarea {
  width: 100%;
  margin-top: 5px;
  padding: 8px 10px;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: 14px;
}

.modal-content button {
  margin-top: 15px;
  width: 100%;
}

/* Close Button */
.close {
  position: absolute;
  right: 20px;
  top: 10px;
  font-size: 22px;
  cursor: pointer;
  color: #666;
}

.close:hover {
  color: #000;
}

@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.9);}
  to { opacity: 1; transform: scale(1);}
}

  .actions {
    display: flex;
    justify-content:space-between;
    align-items:center;

    gap: 10px;
    
    margin-bottom:0;
  }
  
  .btn {
    padding: 6px 12px;
    font-size: 12px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.2s ease-in-out;
  }
  
  .edit-btn {
    background-color: #3f23b1;
    
    color: white;
  }
  
  .edit-btn:hover {
    background-color: #5848d3;
  }
  
  .delete-btn {
    /* background-color: #ff4d4f; */
    background-color: #000000;
    color: white;
  }
  
  .delete-btn:hover {
    background-color: #d9363e;
  }
.house-section{
    
    padding: 10px 15px;
    
    text-align:center;
    
}
.house-list{
    display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
}
.house-card{
    background-color: #fff;
    /* padding: 10px; */
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    overflow:hidden;
    transition: transform 0.3s ease;
    border-radius: 12px;
    padding:10px;
}
.image-container{
    overflow:hidden;
}
.house-card img{
    border-radius: 12px;
    width: 100%;
    height: 150px;
     object-fit: cover;
     transition: transform .5s ease;
     overflow: hidden;
 }
 .house-card img:hover{
    transform: scale(1.1);
    overflow: hidden;
}
.details{
    font-size:12px;
    margin-bottom: 10px;
    /* margin-top:10px; */
}
.card-contents{
    padding: 5px;
}
.card-contents h3{
    font-size:14px;
    margin-right: 10px; 
}
.card-contents .price{
    font-size:14px;
    color:#000000;
    font-weight:bold;
    /* margin-bottom: 10px; */
}
.card-contents .flex{
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom:20px;
}
.card-contents a{
    margin:10px;
    text-decoration: none;
    color: black;
}
.topbar {
    background: #fff;
    padding: 10px;
    /* border-radius: 10px; */
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    /* margin-bottom: 20px; */
  
    display:flex;
    justify-content: space-between;
    align-items: center;

}
.search-bar input {
    width: 100%;
    padding: 10px 20px;
    border: 1px solid #ddd;
    border-radius: 8px;
    font-size: 14px;
}
.topbar button{
    background-color: #7A5AF8;
    padding: 5px 10px;
    text-decoration: none;
    color:white;
    border:none;
    border-radius: 5px;
  
}
/* .search-bar-button-con{
    display: flex;
    gap:1em;
    justify-content: space-between;
} */
    </style>
</head>
<body>
    <div class="topbar">
       
        <div class="search-bar">
            <input  id="searchInput" type="text" placeholder="Search properties..." />
        </div>
        <button id="search-btn">Search</button>
       
        
    </div>
    <div class="house-section">
        <div class="house-list" id="house-list"></div>
        <!-- Edit House Modal -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <h3>Edit House</h3>
      <form id="editHouseForm">
        <input type="hidden" id="editHouseId">

        <label>Title</label>
        <input type="text" id="editTitle" required>

        <label>Price</label>
        <input type="number" id="editPrice" required>

        <label>Location</label>
        <input type="text" id="editLocation" required>

        <label>Description</label>
        <textarea id="editDescription" rows="3" required></textarea>

        <button type="submit" class="btn edit-btn">Save Changes</button>
      </form>
    </div>
  </div>

        </div>
        <script>
            
  let houseData = [];

fetch("/Authentication/backend/get-houses.php")
  .then(res => res.json())
  .then(houses => {
    houseData = houses;
    displayHouses(houseData);
  });

function displayHouses(houses) {
  const container = document.getElementById("house-list");
  container.innerHTML = "";

  if (!houses.length) {
    container.innerHTML = "No houses available at the moment";
    return;
  }

  houses.forEach(house => {
    const card = document.createElement('div');
    card.className = 'house-card';
    card.innerHTML = `
      <div class="image-container">
      <img src="/Authentication/assets/${house.image}" alt="House image" >
      </div>
      <div class="card-contents">
      <div class="flex">
      <h3>${house.title}, ${house.location}</h3>
      <span class="price">$${house.price}</span>
      </div>
      <p class="details">${house.description}</p>
      <div class="actions">
          <button class="btn edit-btn" onclick="editHouse(${house.id})">‚úèÔ∏è Edit</button>
          <button class="btn delete-btn" onclick="deleteHouse(${house.id})">üóëÔ∏è Delete</button>
        </div>
      </div>
      </div>
    `;
    container.appendChild(card);
  });
}

function filterHouses() {
  const query = document.getElementById("searchInput").value.toLowerCase();
  const filtered = houseData.filter(house => 
    house.location.toLowerCase().includes(query) ||
    house.title.toLowerCase().includes(query) ||
    house.price.toLowerCase().includes(query)
  );

  displayHouses(filtered); // ‚úÖ Actually display the filtered results
}
document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("search-btn").addEventListener("click", ()=>{
    document.getElementById("searchInput").value = "";
    filterHouses
  });
  document.getElementById("searchInput").addEventListener("input", filterHouses);
  
});
async function deleteHouse(id) {
  if (!confirm("Are you sure you want to delete this house?")) return;

  const res = await fetch(`/Authentication/backend/delete-house.php?id=${id}`, {
    method: "GET"
  });

  const result = await res.json();
  alert(result.message);
  fetchHouses(); // refresh list
}
function editHouse(id) {
  const house = houseData.find(h => h.id == id);
  if (!house) return;

  // Pre-fill form fields
  document.getElementById("editHouseId").value = house.id;
  document.getElementById("editTitle").value = house.title;
  document.getElementById("editPrice").value = house.price;
  document.getElementById("editLocation").value = house.location;
  document.getElementById("editDescription").value = house.description;

  // Show modal
  document.getElementById("editModal").style.display = "flex";
}

function closeModal() {
  document.getElementById("editModal").style.display = "none";
}

// Handle form submission
document.getElementById("editHouseForm").addEventListener("submit", function(e) {
  e.preventDefault();

  const formData = new FormData();
  formData.append("id", document.getElementById("editHouseId").value);
  formData.append("title", document.getElementById("editTitle").value);
  formData.append("price", document.getElementById("editPrice").value);
  formData.append("location", document.getElementById("editLocation").value);
  formData.append("description", document.getElementById("editDescription").value);

  fetch("/Authentication/backend/edit-house.php", {
    method: "POST",
    body: formData
  })
  .then(res => res.json())
  .then(data => {
    alert(data.message);
    closeModal();
    fetchHouses(); // Refresh list
  });
});

// Close modal when clicking outside
window.onclick = function(event) {
  const modal = document.getElementById("editModal");
  if (event.target === modal) {
    closeModal();
  }
}

        </script>
</body>
</html>